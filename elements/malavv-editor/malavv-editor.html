<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-a11y-keys/iron-a11y-keys.html">
<link rel="import" href="../malavv-config/malavv-config.html">

<dom-module id="malavv-editor">

  <template>
    <iron-a11y-keys target="[[appBody]]" keys="[[keys]]" on-keys-pressed="onKey"></iron-a11y-keys>
  </template>

  <script>
    Polymer({
      is: 'malavv-editor',
      properties: {
        appBody: Object,
        buffer: {
          type: Array,
          value: function() {
            return [];
          }
        },
        activator: {
          type: Array,
          value: function() {
            return config.editor.activator;
          }
        },
        keys: String
      },

      observers: [
        'onBufferChanged(buffer.splices)'
      ],

      ready: function() {
        this.appBody = document.body;
        this.keys = config.editor.keysInActivator;
      },
      onBufferChanged: function() {
        if (arrayEquals(this.activator, this.buffer)) 
          this.fire('activated', {data:null})
      },
      onKey: function(evt) {
        var key;
        if (this.buffer === undefined) this.set('buffer', []);
        key = evt.detail.keyboardEvent.keyIdentifier;
        if (this.buffer.length === this.activator.length) this.shift('buffer');
        this.push('buffer', key);
      }
    });

    function arrayEquals(lhs, rhs) {
      if (lhs === null || lhs === undefined) return false;
      if (rhs === null || rhs === undefined) return false;
      if (!Array.isArray(lhs)) return false;
      if (!Array.isArray(rhs)) return false;
      if (lhs.length !== rhs.length) return false;

      for (var i = 0; i < lhs.length; i++) {
        if (lhs[i] !== rhs[i]) 
          return false
      } 
      return true;
    }
  </script>

</dom-module>