<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">

<link rel="import" href="../malavv-editor/malavv-editor.html">
<link rel="import" href="../malavv-infobar/malavv-infobar.html">
<link rel="import" href="../malavv-card/malavv-card.html">
<link rel="import" href="../malavv-config/malavv-config.html">

<dom-module id="malavv-site">
  <style>
    :host {
      @apply(--layout-horizontal);
      font-family: 'RobotoDraft', sans-serif;
    }
    :host #cards {
      @apply(--layout-horizontal);
      @apply(--layout-flex);
      @apply(--layout-wrap); 
      
      background-color: #fafafa;
      overflow-y: scroll;
      position: relative;
      padding: 10px;
    }

    :host iron-pages {
      @apply(--layout-fit);
      overflow-y: hidden;
    }

    :host #main {
      @apply(--layout);
      height: 100%;
    }
    :host paper-material {
      z-index: 1;
      @apply(--layout-vertical);
    }
    :host malavv-infobar {
      @apply(--layout-flex);
    }
  </style>

  <template>
    <iron-ajax
        auto
        url="{{dataUrl}}"
        handleAs="json"
        on-response="onSiteDataReceived"></iron-ajax>

    <malavv-editor on-activated="onEditorActivated"></malavv-editor>

    <iron-pages selected="{{selected}}">
      <admin-manager cards="{{cards}}"></admin-manager>
      <div id="main">
        <!-- Left Sidebar -->
        <paper-material elevation="2">
          <malavv-infobar></malavv-infobar>
        </paper-material>
        
        <!-- Cards Dashboard -->
        <div id="cards">
          <template is="dom-repeat" items="{{cards}}">
            <malavv-card card="{{item}}"></malavv-card>
          </template>
        </div>
      </div>
    </iron-pages>
    </template>
  </template>

  <script>
    Polymer({
      is: 'malavv-site',
      properties: {
        cards: Array,
        dataUrl: {
          type: String,
          value: config.data.url
        },
        selected: {
          type: Number,
          value: 1
        }
      },

      onSiteDataReceived: function(evt) {
        console.info('Received website data', evt.detail.response);
        this.cards = evt.detail.response.cards;
      },
      onEditorActivated: function() {
        console.info('Switched to editor mode.');
        this.selected = 0;
      }
    });
  </script>



</dom-module>