<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../bower_components/core-drawer-panel/core-drawer-panel.html">
<link rel="import" href="../bower_components/core-header-panel/core-header-panel.html">
<link rel="import" href="../bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="../bower_components/core-icon-button/core-icon-button.html">
<link rel="import" href="../bower_components/core-signals/core-signals.html">
<link rel="import" href="../bower_components/paper-shadow/paper-shadow.html">
<link rel="import" href="../bower_components/core-animated-pages/core-animated-pages.html"

<!-- Whole Site -->
<link rel="import" href="card/card-view.html" />

<!-- Same Package -->
<link rel="import" href="top-card.html" />
<link rel="import" href="my-informations.html" />
<link rel="import" href="konami-signal.html">
<link rel="import" href="admin/admin-manager.html">

<polymer-element name="my-site" layout vertical attributes="manage">
  <template>
    <link rel="stylesheet" type="text/css" href="../css/my-site.css">

    <core-ajax auto url="../data/data.json" handleAs="json" on-core-response="{{handleResponse}}"></core-ajax>
    <konami-signal></konami-signal>
    <core-signals on-core-signal-konami="{{konamiSignal}}"></core-signals>

    <template if="{{!isAdmin}}">
      <core-drawer-panel id="mainDrawer" drawerWidth="310px">

        <!-- Left Sidebar -->
        <div id="sidebar" vertical layout drawer>
          <top-card></top-card>
          <my-informations flex></my-informations>
        </div>

        <!-- Main Content -->
        <core-header-panel id="main" main>
          
            
            <!-- Testing!-->
            <core-animated-pages selected="{{page}}" transitions="hero-transition" on-core-animated-pages-transition-end="{{complete}}">

              <section>

                <div class="chip-container" hero-p on-tap="{{transition}}">

                  <template repeat="{{cards as item}}">

                    <div class="chip" hero-id="{{item.title}}-{{item.secondary}}" hero?="{{selectedAlbum === item }}">
                      <div class="chip-top" style="background: yellow;" hero-id="{{item.title}}-{{item.secondary}}-art" hero?="{{selectedAlbum === item}}"></div>
                      <div class="chip-bottom">
                        <div class="chip-album-title">{{item.secondary}}</div>
                        <div class="chip-artist">{{item.title}}</div>
                      </div>
                    </div>

                  </template>

                </div>
              </section>

              <section id="details">

                <div class="card" layout horizontal hero-id="{{selectedAlbum.title}}-{{selectedAlbum.secondary}}" hero on-tap="{{transition}}">
                  <div class="card-left" style="background: yellow;" hero-id="{{selectedAlbum.title}}-{{selectedAlbum.secondary}}-art" hero></div>
                  <div class="card-right" flex>
                    <div layout horizontal center>
                      <div>
                        <div class="card-icon" style="background: yellow;"></div>
                      </div>
                      <div flex>
                        <div class="card-album-title">{{selectedAlbum.secondary}}</div>
                        <div class="card-album-artist">{{selectedAlbum.title}}</div>
                      </div>
                    </div>
                  </div>
                </div>

              </section>

            </core-animated-pages>
            
          
        </core-header-panel>
      </core-drawer-panel>
    </template>
    
    <template if="{{isAdmin}}">
      <admin-manager cards="{{cards}}" flex>
      </admin-manager>
    </template>
  </template>
  <script>
    Polymer('my-site', {
      page: 0,
      items: [
        { artist: 'Tycho', album: 'Fragments', color: '#f4db33' },
        { artist: 'Tycho', album: 'Past Prologue', color: '#972ff8' },
        { artist: 'Tycho', album: 'Spectre', color: '#7dd6fe' },
        { artist: 'Tycho', album: 'Awake', color: '#dc3c84' }
      ],
      selectedCard: null,
      
      cards: [],
      isAdmin: false,
      handleResponse: function (e) { this.cards = e.detail.response.cards; },
      konamiSignal: function(_, __, ___) {
        console.log("Switch to admin mode");
        this.isAdmin = true;
      },
      onHovered: function(_, __, elem) { 
        elem.expand(); 
      },
      onUnhovered: function(_, __, elem) { 
        elem.collapse(); 
      },
      transition: function(e) {
        if (this.page === 0 && e.target.templateInstance.model.item) {
          this.selectedAlbum = e.target.templateInstance.model.item;
          this.page = 1;
        } else {
          this.page = 0;
        }
      }
    });
  </script>
</polymer-element>